<div class="calendar-header">
  <!-- LEFT VIEW DROPDOWN -->
  <p-dropdown
    *ngIf="showViewDropdown"
    [options]="viewOptions"
    [(ngModel)]="viewMode"
    placeholder="DAY"
    class="view-select"
    styleClass="w-12"
    [showClear]="false"
    (onChange)="onViewModeChange($event.value)"
  >
  </p-dropdown>

  <!-- LEFT TODAY / CALENDAR ICON -->
  <ng-container [ngSwitch]="variant">
    <!-- EVENTS PAGE: TODAY text button -->
    <p-button
      *ngSwitchCase="'events'"
      label="TODAY"
      class="today-btn"
      [ngClass]="variant"
      (onClick)="goToday()"
    >
    </p-button>

    <!-- DASHBOARD: round red icon that opens popup -->
    <p-button
      *ngSwitchCase="'dashboard'"
      class="custom-today-btn"
      (click)="op.toggle($event); dashboard_service.isTimeSelected = false"
    >
      <ng-template pTemplate="icon">
        <img class="calenderimage" src="assets/calender.svg" alt="calendar" />
      </ng-template>
    </p-button>
  </ng-container>

  <!-- MIDDLE DAY / WEEK / MONTH RANGE CONTROLS -->
  <ng-container *ngIf="viewMode !== 'week' && viewMode !== 'month'">
    <button
      class="circle-btn"
      (click)="viewMode === 'day' ? prevDay() : prevMonth()"
    >
      <img
        class="calenderimage"
        src="assets/arrow-circle-left.svg"
        alt="prev"
      />
    </button>

    <span
      class="selected-range font-Neometric-Bold"
      (click)="op.toggle($event); dashboard_service.isTimeSelected = false"
    >
      {{ startDate | date : "dd MMM, yyyy HH:mm:ss " | uppercase }} -
      {{ endDate | date : "dd MMM, yyyy HH:mm:ss " | uppercase }}
    </span>

    <button
      class="circle-btn"
      (click)="viewMode === 'day' ? nextDay() : nextMonth()"
    >
      <img
        *ngIf="viewMode === 'day' && !canNavigateNextDay"
        class="calenderimage"
        src="assets/arrow-circle-right.svg"
        alt="next-disabled"
      />
      <img
        *ngIf="viewMode === 'day' && canNavigateNextDay"
        class="calenderimage inverted"
        src="assets/arrow-circle-right-fill.svg"
        alt="next"
      />
    </button>
  </ng-container>

  <!-- WEEK CARDS -->
  <div class="week-cards" *ngIf="viewMode === 'week'">
    <button class="circle-btn" (click)="prevWeekWindow()">
      <img
        *ngIf="canNavigatePrevWeek"
        class="calenderimage"
        src="assets/arrow-circle-left.svg"
      />
      <img
        *ngIf="!canNavigatePrevWeek"
        class="calenderimage inverted"
        src="assets/arrow-circle-left-fill.svg"
      />
    </button>

    <div
      class="week-card"
      *ngFor="let week of visibleWeekWindow()"
      (click)="selectWeek(week)"
      [class.active]="currentWeekIndex === weeks.indexOf(week)"
    >
      {{ week.label }}
    </div>

    <button class="circle-btn" (click)="nextWeekWindow()">
      <img
        *ngIf="!canNavigateNextWeek"
        class="calenderimage"
        src="assets/arrow-circle-right.svg"
      />
      <img
        *ngIf="canNavigateNextWeek"
        class="calenderimage inverted"
        src="assets/arrow-circle-right-fill.svg"
      />
    </button>
  </div>

  <!-- MONTH CARDS -->
  <div class="month-cards" *ngIf="viewMode === 'month'">
    <button class="circle-btn" (click)="prevMonthWindow()">
      <img
        *ngIf="canNavigatePrevMonth"
        class="calenderimage"
        src="assets/arrow-circle-left.svg"
      />
      <img
        *ngIf="!canNavigatePrevMonth"
        class="calenderimage inverted"
        src="assets/arrow-circle-left-fill.svg"
      />
    </button>

    <div
      class="month-card"
      *ngFor="let month of visibleMonthWindow()"
      (click)="selectMonth(month)"
      [class.active]="currentMonthIndex === months.indexOf(month)"
    >
      {{ month.label }}
    </div>

    <button class="circle-btn" (click)="nextMonthWindow()">
      <img
        *ngIf="!canNavigateNextMonth"
        class="calenderimage"
        src="assets/arrow-circle-right.svg"
      />
      <img
        *ngIf="canNavigateNextMonth"
        class="calenderimage inverted"
        src="assets/arrow-circle-right-fill.svg"
      />
    </button>
  </div>

  <!-- RIGHT ICON / TODAY depending on variant -->
  <ng-container [ngSwitch]="variant">
    <!-- EVENTS PAGE: calendar icon at right -->
    <p-button
      *ngSwitchCase="'events'"
      class="custom-today-btn"
      (click)="op.toggle($event); dashboard_service.isTimeSelected = false"
    >
      <ng-template pTemplate="icon">
        <img class="calenderimage" src="assets/calender.svg" alt="" />
      </ng-template>
    </p-button>

    <!-- DASHBOARD: TODAY text on right -->
    <p-button
      *ngSwitchCase="'dashboard'"
      label="TODAY"
      class="today-btn"
      [ngClass]="variant"
      (onClick)="goToday()"
    >
    </p-button>
  </ng-container>
</div>

<!-- POPUP -->
<p-overlayPanel #op [dismissable]="true" [showCloseIcon]="false">
  <ng-template pTemplate>
    <div class="range-popup">
      <!-- TOGGLE ROW -->
      <div class="range-toggle-row">
        <div class="toggle-item">
          <p-radioButton
            name="mode"
            value="range"
            [(ngModel)]="mode"
            (onClick)="toggleDateRange()"
          ></p-radioButton>
          <label (click)="toggleDateRange()">Date Range</label>
        </div>

        <div class="toggle-item">
          <p-radioButton
            name="mode"
            value="whole"
            [(ngModel)]="mode"
            (onClick)="
              toggleWholeDay(); dashboard_service.isTimeSelected = true
            "
          ></p-radioButton>
          <label (click)="toggleWholeDay()">Whole Day</label>
        </div>
      </div>

      <!-- TOP INPUT BAR (Start / End / Arrow) -->
      <div class="range-input-row">
        <!-- START -->
        <div class="range-input">
          <span class="range-label">Start Date</span>
          <div
            class="range-input-box"
            [class.active]="activeInput === 'start'"
            (click)="activeInput = 'start'"
          >
            <div class="left">
              <i class="pi pi-calendar"></i>
              <span>
                {{ startDate | date : "dd MMM, yyyy" }}
              </span>
            </div>
            <div class="right">
              <i class="pi pi-clock"></i>
              <span>{{ startDate | date : "HH:mm" }}</span>
            </div>
          </div>
        </div>

        <!-- END -->
        <div class="range-input">
          <span class="range-label">End Date</span>
          <div
            class="range-input-box"
            [class.active]="activeInput === 'end'"
            (click)="activeInput = 'end'"
          >
            <div class="left">
              <i class="pi pi-calendar"></i>
              <span>
                {{ endDate | date : "dd MMM, yyyy" }}
              </span>
            </div>
            <div class="right">
              <i class="pi pi-clock"></i>
              <span>{{ endDate | date : "HH:mm" }}</span>
            </div>
          </div>
        </div>

        <!-- RED ARROW BUTTON -->
        <button class="go-btn" (click)="confirmSelection(op)">
          <i class="pi pi-arrow-right"></i>
        </button>
      </div>

      <!-- BODY: CALENDAR + POPULAR TIMES -->
      <div class="range-body">
        <div class="calendar-col">
          <p-calendar
            [(ngModel)]="inlineDate"
            [inline]="true"
            [monthNavigator]="true"
            [yearNavigator]="true"
            [showIcon]="false"
            [touchUI]="false"
            [maxDate]="today"
            (onSelect)="onInlineDateSelect($event)"
          >
          </p-calendar>
        </div>

        <div class="time-col">
          <div class="time-title">Popular Times</div>
          <div class="time-list">
            <button
              *ngFor="let t of popularTimes"
              type="button"
              class="time-pill"
              [class.disabled]="isTimeDisabled(t)"
              (click)="!isTimeDisabled(t) && onPopularTimeClick(t)"
            >
              {{ t }}
            </button>
          </div>
        </div>
      </div>
    </div>
  </ng-template>
</p-overlayPanel>
