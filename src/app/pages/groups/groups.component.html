<div class="dashboard-container">
  <div class="dashboard-content grid-layout">
    <!-- === LEFT SECTION (8 columns) === -->
    <div class="left-section">
      <!-- Section Header -->
      <div class="section-header">
        <h2>QUEUES</h2>
        <button class="createbutton" (click)="onCreateQueueClick()">
          + CREATE QUEUE
        </button>
      </div>

      <!-- Escalated Cards & Search -->
      <div class="calender-section-body">
        <div class="escalated-row">
          <!-- Escalated Cards -->
          <div
            class="calender-escalated-card"
            *ngFor="let e of secondEscalatedDetails; let i = index"
            [ngClass]="{ 'hidden-card': i >= 3 }"
            [ngStyle]="{ 'background-color': i === 0 ? 'red' : 'white' }"
          >
            <span
              class="label"
              [ngStyle]="{
                color: i === 0 ? 'white' : '#000000',
                opacity: i === 0 ? '1' : '0.6'
              }"
            >
              {{ e.label }}
            </span>
            <span
              class="value"
              [ngStyle]="{ color: i === 0 ? 'white' : 'red' }"
            >
              {{ e.value }}
            </span>
          </div>

          <!-- Blank Space -->
          <div class="blank-space"></div>

          <!-- Search Box -->
          <div class="calender-search">
            <input
              type="text"
              placeholder="Search here"
              class="search-input"
              [(ngModel)]="searchTerm"
              (input)="onFilterTextBoxChanged()"
            />
          </div>
        </div>
      </div>

      <!-- AG Grid Table -->
      <div *ngIf="selectedFilter === 'CLOSED'" class="table-section m-t-20">
        <!-- <ag-grid-angular
          style="width: 100%; height: 460px"
          class="ag-theme-alpine"
          theme="legacy"
          [rowData]="rowData"
          [columnDefs]="columnDefs"
          [defaultColDef]="defaultColDef"
          [pagination]="true"
          [paginationPageSize]="15"
          [rowHeight]="30"
          [headerHeight]="30"
          [enableCellTextSelection]="true"
          [enableRangeSelection]="true"
          [copyHeadersToClipboard]="true"
          domLayout="autoHeight"
          [paginationPageSizeSelector]="[15, 50, 100]"
          [localeText]="localeText"
          [quickFilterMatcher]="quickFilterMatcher"
          (gridReady)="onGridReady($event)"
          (cellClicked)="onCellClicked($event)"
        ></ag-grid-angular> -->
        <ag-grid-angular
  style="width: 100%; height: 460px"
  class="ag-theme-alpine"
  theme="legacy"
  [rowData]="rowData"
  [columnDefs]="columnDefs"
  [defaultColDef]="defaultColDef"
  [pagination]="true"
  [paginationPageSize]="15"
  [rowHeight]="30"
  [headerHeight]="30"
  [enableCellTextSelection]="true"
  [enableRangeSelection]="true"
  [copyHeadersToClipboard]="true"
  [paginationPageSizeSelector]="[15, 50, 100]"
  [localeText]="localeText"
  [quickFilterMatcher]="quickFilterMatcher"
  (gridReady)="onGridReady($event)"
  (cellClicked)="onCellClicked($event)"
></ag-grid-angular>
      </div>
    </div>

    <!-- === RIGHT SECTION (4 columns) === -->

    <!-- Default Right Section -->
    <div class="right-section" *ngIf="currentSection === 'default'">
      <!-- Popup Header -->
      <div class="popup-header">
        <div class="popup-header-grid">
          <div class="col col-1">
            <img
              class="calenderimage flip-horizontal1"
              src="assets/headericons/direction-wueues.svg"
              alt=""
            />
          </div>
          <div class="col col-8">
            <p class="label nomargin">{{ selectedItem?.name }}</p>
          </div>
          <div class="col col-1">
            <img
              class="calenderimage"
              (click)="prevItem()"
              src="assets/arrow-circle-left-groups.svg"
              alt=""
            />
          </div>
          <div class="col col-1">
            <p class="nomargin">{{ currentIndex + 1 }}/{{ rowData.length }}</p>
          </div>
          <div class="col col-1">
            <img
              class="calenderimage flip-horizontal"
              (click)="nextItem()"
              src="assets/arrow-circle-left-groups.svg"
              alt=""
            />
          </div>
        </div>
      </div>

      <!-- Popup Body -->
      <div class="popup-body">
        <div class="escalated-content-section">
   <app-groups-popup
  *ngIf="selectedItem"
  [data]="selectedItem"
  [sites]="sites"
  (sectionChange)="onSectionChange($event)"
  (refreshRequested)="onQueueStatusChanged($event)" 
></app-groups-popup>
        </div>
      </div>
    </div>

    <!-- ADD Section (Dynamic for Site/Camera/Employee/Queue) -->
    <div
      class="right-section"
      *ngIf="currentSection !== 'default'"
      [ngClass]="'add-section'"
    >
      <!-- Header -->
      <div class="popup-header">
        <p class="label nomargin">
          {{
            currentSection.toLowerCase() === "queue"
              ? "CREATE QUEUE"
              : currentSection.toLowerCase() === "camera"
              ? "ADD SITE & CAMERA"
              : "ADD " + (currentSection | titlecase | uppercase)
          }}
        </p>
        <img
          class="calenderimage"
          (click)="goBack()"
          src="assets/close-filled.svg"
          alt=""
        />
      </div>

      <!-- Popup Body -->
      <div class="popup-body">
        <!-- ADD Site / Camera Form -->
        <form
          class="add-form"
          *ngIf="currentSection === 'site' || currentSection === 'camera'"
        >
          <div class="form-group">
            <label for="group">Select Queue</label>
            <select id="group" class="form-control" disabled>
              <option [value]="selectedItem?.id">
                {{ selectedItem?.name }}
              </option>
            </select>
          </div>

          <div class="form-group">
            <label for="site">Select Site</label>
            <p-dropdown
              [options]="sitesDropdown"
              placeholder="Select Site"
              [(ngModel)]="selectedSiteId"
              [ngModelOptions]="{ standalone: true }"
              optionLabel="label"
              optionValue="value"
              (onChange)="onSiteChange($event.value)"
              [style]="{ width: '100%' }"
              [filter]="true"
              filterBy="label"
              [showClear]="true"
              filterPlaceholder="Search site"
            ></p-dropdown>
          </div>
          <div class="form-group" *ngIf="currentSection === 'camera'">
            <label for="camera">Select Cameras</label>
            <p-multiSelect
              [options]="camerasDropdown"
              placeholder="Select Cameras"
              [(ngModel)]="selectedCameraIds"
              [ngModelOptions]="{ standalone: true }"
              optionLabel="label"
              optionValue="value"
              [disabled]="!selectedSiteId"
              [style]="{ width: '100%' }"
              display="chip"
            ></p-multiSelect>
          </div>

          <div class="form-actions">
            <button type="button" class="btn cancel-btn" (click)="goBack()">
              Cancel
            </button>
            <button type="submit" (click)="addSiteCamera()" class="btn add-btn">
              Add
            </button>
          </div>
        </form>

        <!-- ADD Employee Form -->
        <div *ngIf="currentSection === 'employee'">
          <form class="add-form">
            <div class="form-group">
              <label for="group">Select Queue</label>
              <select id="group" class="form-control" disabled>
                <option [value]="selectedItem?.id">
                  {{ selectedItem?.name }}
                </option>
              </select>
            </div>

            <div class="form-group">
              <input
                type="text"
                placeholder="Search employees"
                [(ngModel)]="searchUserTerm"
                [ngModelOptions]="{ standalone: true }"
                (input)="currentPage = 1"
                class="form-control"
              />
            </div>

            <div class="form-groups select-all">
              <label> Employee ({{ users.length }}) </label>
              <label class="selectall-text">
                <input
                  type="checkbox"
                  #selectAllCheckbox
                  [checked]="areAllFilteredUsersSelected()"
                  (change)="toggleSelectAll(selectAllCheckbox.checked)"
                />
                Select All
              </label>
            </div>

            <div
              class="escalated-card-container"
              style="max-height: 400px; overflow-y: auto"
            >
              <div class="escalated-card" *ngFor="let user of filteredUsers">
                <div class="escalated-card-content">
                  <input
                    #checkbox
                    type="checkbox"
                    [checked]="selectedUserIds.includes(user.userId)"
                    (change)="
                      toggleUserSelection(user.userId, checkbox.checked)
                    "
                  />
                  <div>
                    <img
                      class="imground"
                      [src]="'assets/user1.png'"
                      alt="{{ user.userName }}"
                    />
                  </div>
                  <div class="nameemail">
                    <h4 class="labelmargin">{{ user.userName }}</h4>
                    <p class="labelmail">
                      {{ user.email }} | {{ user.userContact }}
                    </p>
                  </div>
                </div>
              </div>
            </div>

            <div class="form-actions">
              <button type="button" class="btn cancel-btn" (click)="goBack()">
                Cancel
              </button>
              <button
                type="submit"
                (click)="addSelectedUsers()"
                class="btn add-btn"
              >
                Add
              </button>
            </div>
          </form>
        </div>

        <!-- ADD Queue Form -->
        <form
          class="add-form"
          *ngIf="currentSection === 'queue'"
        >
          <div class="form-group">
            <label for="queueName">Queue Name</label>
            <input
              id="queueName"
              name="queueName"
              class="form-control"
              [(ngModel)]="newQueue.queueName"
              required
            />
          </div>

          <div class="form-group">
            <label for="queueLevel">Queue Level</label>
            <p-dropdown
              [options]="levelsData"
              [(ngModel)]="newQueue.levelId"
              [ngModelOptions]="{ standalone: true }"
              optionLabel="levelName"
              optionValue="levelId"
              placeholder="Select Level"
              [style]="{ width: '100%', height: '35px' }"
            ></p-dropdown>
          </div>

          <div class="form-actions row">
            <div class="col-6">
              <button
                type="button"
                (click)="goBack()"
                class="btn cancel-btn w-100"
              >
                Cancel
              </button>
            </div>
            <div class="col-6">
              <button
                type="submit"
                (click)="createQueue()"
                class="btn add-btn w-100"
              >
                Create
              </button>
            </div>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>
