<div class="dashboard-container">
  <div class="dashboard-content grid-layout">
    <!-- === LEFT SIDE (8 columns) === -->
    <div class="left-section">
      <div class="section-header">
        <h2>QUEUES</h2>
        <button class="createbutton" (click)="onCreateQueueClick()">
         +  CREATE QUEUE
        </button>
      </div>

      <div class="calender-section-body">
        <div class="escalated-row">
          <!-- Escalated cards -->
          <div
            class="calender-escalated-card"
            *ngFor="let e of secondEscalatedDetails; let i = index"
            [ngClass]="{ 'hidden-card': i >= 3 }"
            [ngStyle]="{ 'background-color': i === 0 ? 'red' : 'white' }"
          >
            <span
              class="label"
              [ngStyle]="{
                color: i === 0 ? 'white' : '#ccc'
              }"
            >
              {{ e.label }}
            </span>
            <span
              class="value"
              [ngStyle]="{
                color: i === 0 ? 'white' : 'red'
              }"
            >
              {{ e.value }}
            </span>
          </div>

          <!-- Blank space -->
          <div class="blank-space"></div>

          <!-- Search box -->
          <div class="calender-search">
            <input
              type="text"
              placeholder="Search here"
              [(ngModel)]="searchTerm"
              (input)="onFilterTextBoxChanged()"
            />
          </div>
        </div>
      </div>

      <!-- AG Grid -->
      <div *ngIf="selectedFilter === 'CLOSED'" class="table-section m-t-20">
        <ag-grid-angular
          style="width: 100%; height: 460px"
          theme="legacy"
          class="ag-theme-alpine"
          [rowData]="rowData"
          [columnDefs]="columnDefs"
          [defaultColDef]="defaultColDef"
          [pagination]="true"
          [paginationPageSize]="10"
          [enableCellTextSelection]="true"
          [enableRangeSelection]="true"
          [copyHeadersToClipboard]="true"
          domLayout="autoHeight"
          [paginationPageSizeSelector]="[10, 20, 50, 100]"
          [localeText]="localeText"
          [quickFilterMatcher]="quickFilterMatcher"
          (gridReady)="onGridReady($event)"
          (cellClicked)="onCellClicked($event)"
        >
        </ag-grid-angular>
      </div>
    </div>

    <!-- === RIGHT SIDE (4 columns) === -->
    <!-- Default Right Section -->
    <div class="right-section" *ngIf="currentSection === 'default'">
      <div class="popup-header">
        <div class="popup-header-content">
          <div class="icon-info">
            <img class="calenderimage flip-horizontal1" src="../../../assets/headericons/direction-wueues.svg" alt="" />
         
            <p class="label nomargin"> {{ selectedItem?.name }}</p>
          </div>
        </div>
        <div class="navigation-controls">
          <button class="arrow left-arrow" (click)="prevItem()"> <img class="calenderimage flip-horizontal" src="../../../assets/arrow-circle-right.svg" alt="" /></button>
          <p class="nomargin">{{ currentIndex + 1 }}/{{ rowData.length }}</p>
          <button class="arrow right-arrow" (click)="nextItem()">   <img class="calenderimage" src="../../../assets/arrow-circle-right.svg" alt="" /></button>
        </div>
      </div>
      <div class="popup-body">
        <div class="escalated-content-section">
          <app-groups-popup
            *ngIf="selectedItem"
            [data]="selectedItem"
            [sites]="sites"
            (sectionChange)="onSectionChange($event)"
          >
          </app-groups-popup>
        </div>
      </div>
    </div>

    <!-- ADD Section (Dynamic for Site/Camera/Employee) -->
    <!-- ADD Section (Dynamic for Site/Camera/Employee/Queue) -->
    <div
      class="right-section"
      *ngIf="currentSection !== 'default'"
      [ngClass]="'add-section'"
    >
      <div class="popup-header">
        <!-- <button class="right-arrow" (click)="goBack()">‚Üê</button> -->
        <p class="label nomargin">ADD {{ currentSection | titlecase }}</p>
         <img class="calenderimage" (click)="goBack()" src="../../../assets/close-filled.svg" alt="" />
      </div>

      <div class="popup-body">
        <!-- ADD Site / ADD Camera Form -->
        <form
          class="add-form"
          *ngIf="currentSection === 'site' || currentSection === 'camera'"
        >
          <!-- Select Group -->
          <div class="form-group">
            <label for="group">Select Group</label>
            <select id="group" class="form-control" disabled>
              <option [value]="selectedItem?.id">
                {{ selectedItem?.name }}
              </option>
            </select>
          </div>

          <!-- Select Site -->
          <div class="form-group">
            <label for="site">Select Site</label>
            <p-dropdown
              [options]="sitesDropdown"
              placeholder="Select Site"
              [(ngModel)]="selectedSiteId"
              [ngModelOptions]="{ standalone: true }"
              optionLabel="label"
              optionValue="value"
              (onChange)="onSiteChange($event.value)"
              [style]="{ width: '100%' }"
            ></p-dropdown>
          </div>

          <!-- Select Camera (only for ADD Camera) -->
          <div class="form-group">
            <label for="camera">Select Camera</label>
            <p-dropdown
              [options]="camerasDropdown"
              placeholder="Select Camera"
              [(ngModel)]="selectedCameraId"
              [ngModelOptions]="{ standalone: true }"
              optionLabel="label"
              optionValue="value"
              [disabled]="!selectedSiteId"
              [style]="{ width: '100%' }"
            ></p-dropdown>
          </div>

          <!-- Action Buttons -->
          <div class="form-actions">
            <button type="button" class="btn cancel-btn" (click)="goBack()">
              Cancel
            </button>
            <button type="submit" (click)="addSiteCamera()" class="btn add-btn">
              Add
            </button>
          </div>
        </form>

        <!-- ADD Employee -->
        <div *ngIf="currentSection === 'employee'">
          <form class="add-form">
            <!-- Select Group -->
            <div class="form-group">
              <label for="group">Select Group</label>
              <select id="group" class="form-control" disabled>
                <option [value]="selectedItem?.id">
                  {{ selectedItem?.name }}
                </option>
              </select>
            </div>

            <!-- Search Box -->
            <div class="form-group">
              <input
                type="text"
                placeholder="Search employees"
                [(ngModel)]="searchUserTerm"
                [ngModelOptions]="{ standalone: true }"
                (input)="currentPage = 1"
                class="form-control"
              />
            </div>

            <!-- Users list with scroll -->
            <div
              class="escalated-card-container"
              style="max-height: 400px; overflow-y: auto"
            >
              <div class="escalated-card" *ngFor="let user of filteredUsers">
                <div class="escalated-card-content">
                  <input
                    #checkbox
                    type="checkbox"
                    [checked]="selectedUserIds.includes(user.userId)"
                    (change)="
                      toggleUserSelection(user.userId, checkbox.checked)
                    "
                  />
                  <div>
                    <img
                      class="imground"
                      [src]="'../../../assets/user1.png'"
                      alt="{{ user.userName }}"
                    />
                  </div>
                  <div class="nameemail">
                    <h4 class="labelmargin">{{ user.userName }}</h4>
                    <p class="labelmail">
                      {{ user.email }} | {{ user.userContact }}
                    </p>
                  </div>
                </div>
              </div>
            </div>

            <!-- Pagination controls -->
            <div class="pagination-controls" *ngIf="totalPages > 1">
              <button
                type="button"
                class="btn"
                (click)="goToPage(currentPage - 1)"
                [disabled]="currentPage === 1"
              >
                Prev
              </button>
              <span>Page {{ currentPage }} of {{ totalPages }}</span>
              <button
                type="button"
                class="btn"
                (click)="goToPage(currentPage + 1)"
                [disabled]="currentPage === totalPages"
              >
                Next
              </button>
            </div>

            <!-- Action Buttons -->
            <div class="form-actions">
              <button type="button" class="btn cancel-btn" (click)="goBack()">
                Cancel
              </button>
              <button
                type="submit"
                (click)="addSelectedUsers()"
                class="btn add-btn"
              >
                Add
              </button>
            </div>
          </form>
        </div>

        <!-- ADD Queue -->
        <form
          class="add-form"
          *ngIf="currentSection === 'queue'"
          (ngSubmit)="createQueue()"
        >
          <!-- Queue Name -->
          <div class="form-group">
            <label for="queueName">Queue Name</label>
            <input
              id="queueName"
              name="queueName"
              class="form-control"
              [(ngModel)]="newQueue.queueName"
              required
            />
          </div>

          <!-- Queue Level -->
          <div class="form-group">
            <label for="queueLevel">Level</label>

            <p-dropdown
              [options]="levelsData"
              [(ngModel)]="newQueue.levelId"
              [ngModelOptions]="{ standalone: true }"
              optionLabel="levelName"
              optionValue="levelId"
              placeholder="Select Level"
             [style]="{ width: '100%', height: '35px' }"
            >
            </p-dropdown>
          </div>

          <!-- Action Buttons -->
          <div class="form-actions row">
            <div class="col-6">
              <button type="button" class="btn cancel-btn w-100">Cancel</button>
            </div>
            <div class="col-6">
              <button
                type="submit"
                (click)="createQueue()"
                class="btn add-btn w-100"
              >
               Create
              </button>
            </div>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>
